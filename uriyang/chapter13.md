# 13장 - 웹페이지의 성능을 측정하는 다양한 방법

## 1 애플리케이션에서 확인하기

### 1.1 create-react-app
- reportWebBitals 함수는 웹에서 성능을 측정하기 위한 함수
- 누적 레이아웃 이동(CLS), 최초 입력 지연(FID), 최초 콘텐츠풀 페인트(FCP), 최대 콘텐츠 페인팅(LCP), 첫 바이트까지의 시간(TTFB)을 측정하는 용도
- PerformanceObserver는 웹페이지에서 다양한 성능을 측정할 수 있도록 도와주는 API [[Performance_API]](https://developer.mozilla.org/en-US/docs/Web/API/Performance_API)
- ReportHandler는 콘솔 출력 및 서버로 전송하는 작업 등을 할 수 있다.

### 1.2 create-next-app
- Next.js는 성능 측정 메서드인 NextWebVitalsMetric을 제공
- reportWebVitals는 _app에 예약어로 지정된 함수
```javascript
import { NextWebVitalsMetric } from 'next/app'
export function reportWebVitals(metric: NextWebVitalsMetric) {
  console.log(metric)
}
```
- Next.js에 특화된 사용자 지표
  - Next.js-hydration: 페이지가 서버 사이드에서 렌더링되어 하이드레이션하는 데 걸린 시간
  - Next.js-route-change-to-render: 페이지가 경로를 변경한 후 페이지를 렌더링을 시작하는 데 걸리는 시간
  - Next.js-render: 경로 변경이 완료된 후 페이지를 렌더링하는 데 걸린 시간

## 2 구글 라이트하우스
- 구글에서 제공하는 웹 페이지 성능 측정 도구
- 핵심 웹 지표뿐만 아니라 접근성, PWA, SEO 등 웹 페이지를 둘러싼 다양한 요소들을 측정하고 점건할 수 있다.

### 2.1 구글 라이트하우스 - 탐색 모드
> #### 성능
  - 핵심 웹 지표 외 3가지 추가적인 지표
    - Time to Interactive: 사용자가 완전히 상호작용할 수 있을 때까지 걸리는 시간
    - Speed Index: 페이지가 로드되는 동안 콘텐츠가 얼마나 빨리 시각적으로 표시되는지를 계산
    - Total Blocking Time: 메인 스레드가 차단된 총 시간

> #### 접근성
  - 장애인 및 고령자 등 신체적으로 불편한 사람들이 일반적인 사용자와 동등하게 웹페이지를 이용할 수 있도록 보장하는 것

> #### 권장사항
  - 웹사이트를 개발할 때 고려해야 할 요소들을 얼마나 지키고 있는지 확인
  - 권장사항
    - CSP가 XSS 공격에 효과적인지 확인: 제3자가 삽입한 스크립트를 통해 공격하는 기법을 제한하는 정책
    - 감지된 JavaScript 라이브러리
    - HTTPS 사용
    - 페이지 로드 시 위치정보 권한 요청 방지하기:
    - 페이지 로드 시 알림 권한 요청 방지하기:
    - 알려진 보안 취약점이 있는 프렌트엔드 자바스크립트 라이브러리를 사용하지 않음
    - 사용자가 비밀번호 입력란에 붙여넣을 수 있도록 허용
    - 이미지를 올바른 가로세로 비율로 표시
    - 이미지가 적절한 해상도로 제공됨
    - 페이지에 HTML Doctype 있음:
    - 문자 집합을 제대로 정의함:
    - 지원 중단 API 사용하지 않기
    - 콘솔에 로그된 브라우저 오류 없음
    - Chrome Devtools의 Issues 패널에 문제없음
    - 페이지에 유효한 소스 맵이 있음
    - font-display

> #### 검색 엔진 최적화
  - 웹페이지가 검색엔진이 쉽게 웹페이지 정보를 가져가서 공개할 수 있도록 최적화돼 있는지를 확인하는 것

### 2.2 구글 라이트하우스 - 기간 모드
- 실제 웹페이지를 탐색하는 동안 지표를 측정

> #### 흔적
- 웹 성능을 추적한 기간을 성능탭에서 보여준다.

> #### 트리맵
- 페이지를 불러올 때 함께 로딩한 모든 리소스를 함께 모아서 볼 수 있는 곳

### 2.3 구글 라이트하우스 - 스냅샷
- 탐색 모드와 유사하지만 현재 페이지 상태를 기준으로 분석

## 3 WebPageTest
- 성능을 분석하는 도구로 널리 알려진 도구

### 3.1 Performance Summary
- 전체적인 결과를 요약

### 3.2 Opportunities & Experiments
### 3.3 Filmstrip
- 웹사이트를 필름 보는 것처럼 시간의 흐름에 따라 어떻게 웹사이트가 그려졌는지 볼 수 있는 메뉴

### 3.4 Details
- Filmstrip의 내용을 자세히 보여주는 영역

### 3.5 Web Vitals
- LCP, CLS, TBT에 대한 자세한 내용 확인

### 3.6 Optimizations
- 리소스들이 얼마나 최적화돼 있는지 나타낸다.

### 3.7 Content
- 웹사이트에서 제공하는 콘텐츠, 에셋을 종류별로 묶어 통계를 보여줌

### 3.8 Domains
- Content 메뉴에서 보여준 에셋들이 어느 도메인에서 왔는지를 도메인별로 묶어서 확인

### 3.9 Console Log
- 사용자가 웹페이지에 접속했을 때 console.log로 무엇이 기록됐는지 확인

### 3.10 Detected Technologies
- 웹사이트를 개발하는 데 사용된 기술을 확인

### 3.11 Main-thread Processing
- 메인 스레드가 어떤 작업을 처리했는지 확인

### 3.12 Lighthouse Report
- 구글 라이트하우스 리포트 확인


## 크롬 개발자 도구

### 4.1 성능 통계
> #### Insights
- 성능을 측정하는 기간 동안 발생한 이벤트 중 눈여겨봐야 할 내용을 시간의 흐름에 따라 모아서 보여준다.

> #### 메인 메뉴
- 성능을 측정하는 기간 동안 무슨 일이 일어나는지 확인할 수 있는 다양한 기능을 제공


### 4.2 성능
- Performance Insights 탭이 등장하기 이전부터 있던 탭

> #### 메뉴

> #### 요약
- 측정 기간의 CPU, 네트워크 요청, 스크린숏, 메모리 점유율 등을 요약해서 볼 수 있다.

> #### 네트워크
- 성능 측정 기간 동안에 발생한 모든 네트워크 요청 확인

> #### Web vitals
- 핵심 웹 지표 시점을 확인

> #### 소요 시간과 기본
- 시간이 흐름에 따라 메인 스레드의 작업은 어떻게 이뤄졌는지, 또 자바스크림트 힙 영역을 어떻게 변화하는지 등을 확인
